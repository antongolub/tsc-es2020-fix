<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>tsc-esm-fix</title><meta name="description" content="Documentation for tsc-esm-fix"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">tsc-esm-fix</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>tsc-esm-fix </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#tsc-esm-fix" id="tsc-esm-fix" style="color: inherit; text-decoration: none;">
  <h1>tsc-esm-fix</h1>
</a>
<p>Make TS projects compatible with <a href="https://nodejs.org/api/esm.html#esm_packages">esm/mjs requirements</a></p>
<p><a href="https://github.com/antongolub/tsc-esm-fix/actions"><img src="https://github.com/antongolub/tsc-esm-fix/workflows/CI/badge.svg" alt="CI"></a>
<a href="https://codeclimate.com/github/antongolub/tsc-esm-fix/maintainability"><img src="https://api.codeclimate.com/v1/badges/795c6c62e875c263e2fa/maintainability" alt="Maintainability"></a>
<a href="https://codeclimate.com/github/antongolub/tsc-esm-fix/test_coverage"><img src="https://api.codeclimate.com/v1/badges/795c6c62e875c263e2fa/test_coverage" alt="Test Coverage"></a>
<a href="https://www.npmjs.com/package/tsc-esm-fix"><img src="https://img.shields.io/npm/v/tsc-esm-fix" alt="npm (tag)"></a></p>
<ul>
<li><a href="#problem">Problem</a></li>
<li><a href="#solutions">Solutions</a></li>
<li><a href="#features">Features</a></li>
<li><a href="#getting-started">Getting started</a><ul>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#install">Install</a></li>
<li><a href="#usage-examples">Usage examples</a></li>
<li><a href="#cli">CLI</a></li>
<li><a href="#jsts-api">JS/TS API</a></li>
</ul>
</li>
<li><a href="#alternatives">Alternatives</a></li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#references">References</a></li>
<li><a href="#license">License</a></li>
</ul>

<a href="#problem" id="problem" style="color: inherit; text-decoration: none;">
  <h3>Problem</h3>
</a>
<p>This workaround is aimed to bypass a bunch of <strong>tsc</strong>, <strong>ts-jest</strong> and <strong>esbuild</strong> issues <em>right here and right now</em>. </p>
<ul>
<li><a href="https://github.com/microsoft/TypeScript/issues/13422">TS/13422</a> / <a href="https://github.com/microsoft/TypeScript/issues/16577">TS/16577</a>: <strong>tsc</strong> should add <code>.js</code> extensions for relative module paths if compiled as <a href="https://www.typescriptlang.org/tsconfig/#module"><code>es2020/esnext</code></a>.</li>
<li><a href="https://github.com/kulshekhar/ts-jest/issues/1174">ts-jest/1174</a>: <code>import.meta</code> is not allowed.</li>
<li><a href="https://github.com/evanw/esbuild/issues/1043">esbuild/1043</a>: empty output for interface files that breaks reimport.</li>
</ul>

<a href="#moduleresolution-nodenext" id="moduleresolution-nodenext" style="color: inherit; text-decoration: none;">
  <h4>moduleResolution: nodenext</h4>
</a>
<p><a href="https://www.typescriptlang.org/docs/handbook/nightly-builds.html">Nightly build TypeScript 4.7</a> provides <a href="https://www.typescriptlang.org/docs/handbook/esm-node.html">experimental esm support</a>. But it still forces to add extensions by hand (tested on <a href="https://www.npmjs.com/package/typescript/v/4.7.0-dev.20220408">4.7.0-dev.20220408</a>).</p>
<pre><code class="language-shell"><span class="hl-0">src/main/ts/q/u/x/index.ts:1:21 - error TS2835: Relative import paths need explicit file extensions </span><span class="hl-1">in</span><span class="hl-0"> EcmaScript imports when </span><span class="hl-2">&#39;--moduleResolution&#39;</span><span class="hl-0"> is </span><span class="hl-2">&#39;node12&#39;</span><span class="hl-0"> or </span><span class="hl-2">&#39;nodenext&#39;</span><span class="hl-0">. Did you mean </span><span class="hl-2">&#39;../../../foo.js&#39;</span><span class="hl-0">?</span><br/><br/><span class="hl-0">1 import { foo } from </span><span class="hl-2">&#39;../../../foo&#39;</span>
</code></pre>
<p>Moreover, if understand <a href="https://github.com/microsoft/TypeScript/issues/49271">TS/49271</a> correctly, <code>nodenext</code> + pkg.json <code>type: module</code> requires the <code>.js</code> extension in <code>.d.ts</code> files of <strong>external</strong> ESM packages too. Well, good luck with that.</p>

<a href="#solutions" id="solutions" style="color: inherit; text-decoration: none;">
  <h3>Solutions</h3>
</a>
<ol>
<li>Post-process tsc-compiled outputs each time after build.</li>
<li>Patch project sources once as Sindre recommends in <a href="https://github.com/sindresorhus/meta/discussions/15">ESM migration guide</a></li>
<li>Use <a href="https://github.com/cevek/ttypescript">ttypescript</a> with <a href="https://github.com/Zoltu/typescript-transformer-append-js-extension/">transformer-append-js-ext plugin</a></li>
</ol>
<p>This lib covers options 1 and 2.</p>

<a href="#features" id="features" style="color: inherit; text-decoration: none;">
  <h3>Features</h3>
</a>
<ul>
<li>Injects extensions to imports/re-exports statements.<ul>
<li><code>import {foo} from &#39;./foo&#39;</code> → <code>import {foo} from &#39;./foo.js&#39;</code></li>
<li><code>import {baz} from &#39;external/baz&#39;</code> → <code>import {baz} from &#39;external/baz.js&#39;</code></li>
<li>Note, <a href="https://nodejs.org/api/esm.html#esm_packages">including the file extension is only necessary for packages without an &quot;exports&quot; field</a>. So in this case all the external refs remain as are.</li>
<li>Pays attention to index files: <code>import {bar} from &#39;./bar&#39;</code> → <code>import {bar} from &#39;./bar/index.js&#39;</code></li>
<li>Handles <code>.</code> and <code>..</code> shortcuts<ul>
<li><code>export * from &#39;.&#39;</code> → <code>export * from &#39;./index.js&#39;</code></li>
<li><code>export * from &#39;..&#39;</code> → <code>export * from &#39;../index.js&#39;</code></li>
</ul>
</li>
<li>Injects <code>.js</code> extensions into  <code>.d.ts</code> libdef files</li>
</ul>
</li>
<li>Follows <code>outDir</code> found in <strong>tsconfig.json</strong>.  </li>
<li>Searches and replaces <code>__dirname</code> and <code>__filename</code> refs with <code>import.meta</code>.</li>
<li>Fills blank files with <code>export {}</code> (<a href="https://github.com/evanw/esbuild/issues/1043">esbuild issue 1043</a>)</li>
<li>Patches <code>require</code> statements with new file refs if ext changes (<a href="https://2ality.com/2019/10/hybrid-npm-packages.html">hybrid/dual pkg</a>)</li>
<li>Changes file extensions (applied to local deps only).</li>
<li>Supports Windows-based runtimes.</li>
</ul>

<a href="#getting-started" id="getting-started" style="color: inherit; text-decoration: none;">
  <h2>Getting started</h2>
</a>

<a href="#requirements" id="requirements" style="color: inherit; text-decoration: none;">
  <h3>Requirements</h3>
</a>
<p>Node.js <code>^12.20.0 || ^14.13.1 || &gt;=16.0.0</code></p>

<a href="#fetching" id="fetching" style="color: inherit; text-decoration: none;">
  <h3>Fetching</h3>
</a>
<pre><code class="language-shell"><span class="hl-0">npm i -dev tsc-esm-fix</span><br/><span class="hl-0">yarn add -D tsc-esm-fix</span><br/><br/><span class="hl-3"># or w/o saving to package.json</span><br/><span class="hl-0">npx tsc-esm-fix [options]</span>
</code></pre>

<a href="#usage-examples" id="usage-examples" style="color: inherit; text-decoration: none;">
  <h3>Usage examples</h3>
</a>
<pre><code class="language-shell"><span class="hl-0">tsc-esm-fix [options]</span><br/><br/><span class="hl-3"># to post-process outputs each time</span><br/><span class="hl-0">tsc-esm-fix --target=</span><span class="hl-2">&#39;target/es6&#39;</span><br/><br/><span class="hl-3"># to patch ts sources once</span><br/><span class="hl-0">tsc-esm-fix --src=</span><span class="hl-2">&#39;src/main/ts&#39;</span><span class="hl-0"> --ext=</span><span class="hl-2">&#39;.js&#39;</span>
</code></pre>
<pre><code class="language-typescript"><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-4">fix</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;tsc-esm-fix&#39;</span><br/><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">fix</span><span class="hl-0">({</span><br/><span class="hl-0">  </span><span class="hl-4">dirnameVar:</span><span class="hl-0"> </span><span class="hl-6">true</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-4">filenameVar:</span><span class="hl-0"> </span><span class="hl-6">true</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-4">ext:</span><span class="hl-0"> </span><span class="hl-6">true</span><br/><span class="hl-0">})</span>
</code></pre>
<p><strong>Input</strong><br><a href="https://github.com/antongolub/tsc-esm-fix/blob/master/src/test/fixtures/ts-project/src/main/ts/index.ts">code ref</a></p>
<pre><code class="language-js"><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-4">foo</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;./foo&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">import</span><span class="hl-0"> </span><span class="hl-2">&#39;./bar&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-3">// external cjs module</span><br/><span class="hl-1">import</span><span class="hl-0"> </span><span class="hl-6">*</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-4">e1def</span><span class="hl-0"> </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;e1/a/b/c&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">import</span><span class="hl-0"> </span><span class="hl-6">*</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-4">e1root</span><span class="hl-0"> </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;e1&#39;</span><span class="hl-0">;</span><br/><span class="hl-6">const</span><span class="hl-0"> { </span><span class="hl-7">e1</span><span class="hl-0"> } = </span><span class="hl-4">e1def</span><span class="hl-0">;</span><br/><span class="hl-6">const</span><span class="hl-0"> { </span><span class="hl-4">e1</span><span class="hl-0">: </span><span class="hl-7">e1x</span><span class="hl-0"> } = </span><span class="hl-4">e1root</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">e1</span><span class="hl-0">, </span><span class="hl-4">e1x</span><span class="hl-0"> };</span><br/><br/><span class="hl-3">// external esm module with `main` in pkg.json</span><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">m1</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;m1&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">m1</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-4">m1x</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;m1/index&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-3">// external esm module with `exports` in pkg.json</span><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">e2</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;e2&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">e2</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-4">es3</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;e2/index&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">e2</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-4">es4</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;e2/alias&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">e2foo</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;e2/foo&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">e2bar</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;e2/bar-bundle&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-1">export</span><span class="hl-0"> </span><span class="hl-6">*</span><span class="hl-0"> </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;./foo&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> </span><span class="hl-6">*</span><span class="hl-0"> </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;./baz&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> </span><span class="hl-6">*</span><span class="hl-0"> </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;./q/u/x&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">foobaz</span><span class="hl-0"> = </span><span class="hl-4">foo</span><span class="hl-0"> + </span><span class="hl-2">&#39;baz&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">foo</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-4">foo1</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;./foo.js&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-3">// Dir with index.js file inside: ./qux.js/index.js</span><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">qux</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;./qux.js&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-1">export</span><span class="hl-0"> </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">dirname</span><span class="hl-0"> = </span><span class="hl-4">__dirname</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">filename</span><span class="hl-0"> = </span><span class="hl-4">__filename</span><span class="hl-0">;</span><br/><br/><span class="hl-4">console</span><span class="hl-0">.</span><span class="hl-5">log</span><span class="hl-0">(</span><span class="hl-4">foobaz</span><span class="hl-0">);</span>
</code></pre>
<p><strong>Output</strong></p>
<pre><code class="language-js"><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-4">foo</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;./foo.js&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">import</span><span class="hl-0"> </span><span class="hl-2">&#39;./bar.js&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-1">import</span><span class="hl-0"> </span><span class="hl-6">*</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-4">e1def</span><span class="hl-0"> </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;e1/a/b/c/index.js&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">import</span><span class="hl-0"> </span><span class="hl-6">*</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-4">e1root</span><span class="hl-0"> </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;e1&#39;</span><span class="hl-0">;</span><br/><span class="hl-6">const</span><span class="hl-0"> { </span><span class="hl-7">e1</span><span class="hl-0"> } = </span><span class="hl-4">e1def</span><span class="hl-0">;</span><br/><span class="hl-6">const</span><span class="hl-0"> { </span><span class="hl-4">e1</span><span class="hl-0">: </span><span class="hl-7">e1x</span><span class="hl-0"> } = </span><span class="hl-4">e1root</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">e1</span><span class="hl-0">, </span><span class="hl-4">e1x</span><span class="hl-0"> };</span><br/><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">m1</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;m1&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">m1</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-4">m1x</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;m1/index.js&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">e2</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;e2&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">e2</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-4">es3</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;e2/index&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">e2</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-4">es4</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;e2/alias&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">e2foo</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;e2/foo&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">e2bar</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;e2/bar-bundle&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-1">export</span><span class="hl-0"> </span><span class="hl-6">*</span><span class="hl-0"> </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;./foo.js&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> </span><span class="hl-6">*</span><span class="hl-0"> </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;./baz/index.js&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> </span><span class="hl-6">*</span><span class="hl-0"> </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;./q/u/x/index.js&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">foobaz</span><span class="hl-0"> = </span><span class="hl-4">foo</span><span class="hl-0"> + </span><span class="hl-2">&#39;baz&#39;</span><span class="hl-0">;</span><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">foo</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-4">foo1</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;./foo.js&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-1">export</span><span class="hl-0"> { </span><span class="hl-4">qux</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;./qux.js/index.js&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-1">export</span><span class="hl-0"> </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">dirname</span><span class="hl-0"> =</span><span class="hl-8"> /file:</span><span class="hl-9">\\\\</span><span class="hl-8">/</span><span class="hl-0">\\\\</span><span class="hl-8">/</span><span class="hl-10">(</span><span class="hl-8">.</span><span class="hl-11">+</span><span class="hl-10">)</span><span class="hl-9">\\\\</span><span class="hl-8">/</span><span class="hl-0">[^</span><span class="hl-8">/]/</span><span class="hl-0">.</span><span class="hl-5">exec</span><span class="hl-0">(</span><span class="hl-1">import</span><span class="hl-0">.</span><span class="hl-4">meta</span><span class="hl-0">.</span><span class="hl-4">url</span><span class="hl-0">)[</span><span class="hl-12">1</span><span class="hl-0">];</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-4">filename</span><span class="hl-0"> =</span><span class="hl-8"> /file:</span><span class="hl-9">\\\\</span><span class="hl-8">/</span><span class="hl-0">\\\\</span><span class="hl-8">/</span><span class="hl-10">(</span><span class="hl-8">.</span><span class="hl-11">+</span><span class="hl-10">)</span><span class="hl-8">/</span><span class="hl-0">.</span><span class="hl-5">exec</span><span class="hl-0">(</span><span class="hl-1">import</span><span class="hl-0">.</span><span class="hl-4">meta</span><span class="hl-0">.</span><span class="hl-4">url</span><span class="hl-0">)[</span><span class="hl-12">1</span><span class="hl-0">];</span>
</code></pre>

<a href="#cli" id="cli" style="color: inherit; text-decoration: none;">
  <h3>CLI</h3>
</a>
<pre><code class="language-shell"><span class="hl-0">tsc-esm-fix [opts]</span>
</code></pre>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td><code>--tsconfig</code></td>
<td>Path to project&#39;s ts-config(s)</td>
<td><code>tsconfig.json</code></td>
</tr>
<tr>
<td><code>--src</code></td>
<td>Entry points where the ts-source files are placed. If defined <code>src</code> option suppresses <code>target</code></td>
<td></td>
</tr>
<tr>
<td><code>--target</code></td>
<td>tsc-compiled output directory</td>
<td>If not specified inherited from tsconfig.json <strong>compilerOptions.outDir</strong></td>
</tr>
<tr>
<td><code>--dirnameVar</code></td>
<td>Replace <code>__dirname</code> usages with <code>import.meta</code></td>
<td>true</td>
</tr>
<tr>
<td><code>--filenameVar</code></td>
<td>Replace <code>__filename</code> var references with <code>import.meta</code> statements</td>
<td>true</td>
</tr>
<tr>
<td><code>--ext</code></td>
<td>Append extension to relative imports/re-exports</td>
<td><code>.js</code></td>
</tr>
<tr>
<td><code>--unlink</code></td>
<td>Remove original files if ext changes</td>
<td>true</td>
</tr>
<tr>
<td><code>--fillBlank</code></td>
<td>Fill blank files with <code>export {}</code></td>
<td>false</td>
</tr>
<tr>
<td><code>--cwd</code></td>
<td>cwd</td>
<td><code>process.cwd()</code></td>
</tr>
<tr>
<td><code>--out</code></td>
<td>Output dir. Defaults to <code>cwd</code>, so files would be overwritten</td>
<td><code>process.cwd()</code></td>
</tr>
<tr>
<td><code>--debug</code></td>
<td>Prints debug notes</td>
<td></td>
</tr>
</tbody></table>

<a href="#--target-vs---src" id="--target-vs---src" style="color: inherit; text-decoration: none;">
  <h4>--target vs --src</h4>
</a>
<p>When <code>--src</code> option is used, the util just modifies file contents in place.
<code>--target</code> also renames files to change their extension.
You may prevent deletion original of files by using <code>--no-unlink</code>.</p>

<a href="#glob-patterns" id="glob-patterns" style="color: inherit; text-decoration: none;">
  <h4>glob patterns</h4>
</a>
<p>By default, the util looks for <code>ts/tsx</code> files in <code>src</code> directory and <code>js/d.ts</code> files in <code>target</code>. But you can specify custom patterns via corresponding options. For example: <code>--src=&#39;src/main/ts/**/*.ts&#39;</code>.</p>
<pre><code class="language-js"><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">patterns</span><span class="hl-0"> =</span><br/><span class="hl-0">  </span><span class="hl-4">sources</span><span class="hl-0">.</span><span class="hl-4">length</span><span class="hl-0"> &gt; </span><span class="hl-12">0</span><br/><span class="hl-0">    ? </span><span class="hl-4">sources</span><span class="hl-0">.</span><span class="hl-5">map</span><span class="hl-0">((</span><span class="hl-4">src</span><span class="hl-0">) </span><span class="hl-6">=&gt;</span><span class="hl-0"> </span><span class="hl-4">src</span><span class="hl-0">.</span><span class="hl-5">includes</span><span class="hl-0">(</span><span class="hl-2">&#39;*&#39;</span><span class="hl-0">) ? </span><span class="hl-4">src</span><span class="hl-0"> : </span><span class="hl-2">`</span><span class="hl-6">${</span><span class="hl-4">src</span><span class="hl-6">}</span><span class="hl-2">/**/*.{ts,tsx}`</span><span class="hl-0">)</span><br/><span class="hl-0">    : </span><span class="hl-4">targets</span><span class="hl-0">.</span><span class="hl-5">map</span><span class="hl-0">((</span><span class="hl-4">target</span><span class="hl-0">) </span><span class="hl-6">=&gt;</span><span class="hl-0"> </span><span class="hl-4">target</span><span class="hl-0">.</span><span class="hl-5">includes</span><span class="hl-0">(</span><span class="hl-2">&#39;*&#39;</span><span class="hl-0">) ? </span><span class="hl-4">target</span><span class="hl-0"> : </span><span class="hl-2">`</span><span class="hl-6">${</span><span class="hl-4">target</span><span class="hl-6">}</span><span class="hl-2">/**/*.{js,d.ts}`</span><span class="hl-0">)</span>
</code></pre>

<a href="#jsts-api" id="jsts-api" style="color: inherit; text-decoration: none;">
  <h3>JS/TS API</h3>
</a>
<pre><code class="language-ts"><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-4">fix</span><span class="hl-0">, </span><span class="hl-4">IFixOptions</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-2">&#39;tsc-esm-fix&#39;</span><br/><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">fixOptions</span><span class="hl-0">: </span><span class="hl-13">IFixOptions</span><span class="hl-0"> = {</span><br/><span class="hl-0">  </span><span class="hl-4">tsconfig:</span><span class="hl-0"> </span><span class="hl-2">&#39;tsconfig.build.json&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-4">dirnameVar:</span><span class="hl-0"> </span><span class="hl-6">true</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-4">filenameVar:</span><span class="hl-0"> </span><span class="hl-6">true</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-4">ext:</span><span class="hl-0"> </span><span class="hl-6">true</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">fix</span><span class="hl-0">(</span><span class="hl-4">fixOptions</span><span class="hl-0">)</span>
</code></pre>
<pre><code class="language-typescript"><span class="hl-1">export</span><span class="hl-0"> </span><span class="hl-6">interface</span><span class="hl-0"> </span><span class="hl-13">IFixOptions</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-4">cwd</span><span class="hl-0">: </span><span class="hl-13">string</span><br/><span class="hl-0">  </span><span class="hl-4">src</span><span class="hl-0">?: </span><span class="hl-13">string</span><span class="hl-0"> | </span><span class="hl-13">string</span><span class="hl-0">[]</span><br/><span class="hl-0">  </span><span class="hl-4">target</span><span class="hl-0">?: </span><span class="hl-13">string</span><span class="hl-0"> | </span><span class="hl-13">string</span><span class="hl-0">[]</span><br/><span class="hl-0">  </span><span class="hl-4">out</span><span class="hl-0">?: </span><span class="hl-13">string</span><br/><span class="hl-0">  </span><span class="hl-4">tsconfig</span><span class="hl-0">?: </span><span class="hl-13">string</span><span class="hl-0"> | </span><span class="hl-13">string</span><span class="hl-0">[]</span><br/><span class="hl-0">  </span><span class="hl-4">dirnameVar</span><span class="hl-0">: </span><span class="hl-13">boolean</span><br/><span class="hl-0">  </span><span class="hl-4">filenameVar</span><span class="hl-0">: </span><span class="hl-13">boolean</span><br/><span class="hl-0">  </span><span class="hl-4">fillBlank</span><span class="hl-0">?: </span><span class="hl-13">boolean</span><br/><span class="hl-0">  </span><span class="hl-4">ext</span><span class="hl-0">: </span><span class="hl-13">boolean</span><span class="hl-0"> | </span><span class="hl-13">string</span><br/><span class="hl-0">  </span><span class="hl-4">unlink</span><span class="hl-0">?: </span><span class="hl-13">boolean</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-4">debug</span><span class="hl-0">?: </span><span class="hl-13">boolean</span><span class="hl-0"> | </span><span class="hl-13">IFunction</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#alternatives" id="alternatives" style="color: inherit; text-decoration: none;">
  <h2>Alternatives</h2>
</a>
<ul>
<li><a href="https://github.com/mothepro/tsc-esm">https://github.com/mothepro/tsc-esm</a></li>
<li><a href="https://github.com/digital-loukoum/tsc-esm">https://github.com/digital-loukoum/tsc-esm</a></li>
<li><a href="https://github.com/beenotung/fix-esm-import-path">https://github.com/beenotung/fix-esm-import-path</a></li>
</ul>

<a href="#contributing" id="contributing" style="color: inherit; text-decoration: none;">
  <h2>Contributing</h2>
</a>
<p>Feel free to open any issues: bug reports, feature requests or questions.
You&#39;re always welcome to suggest a PR. Just fork this repo, write some code, add some tests and push your changes.
Any feedback is appreciated.</p>

<a href="#references" id="references" style="color: inherit; text-decoration: none;">
  <h2>References</h2>
</a>
<ul>
<li><a href="https://github.com/microsoft/TypeScript/issues/13422">TypeScript/issues/13422: TypeScript and script <code>type=&quot;module&quot;</code></a></li>
<li><a href="https://github.com/microsoft/TypeScript/issues/28288">TypeScript/issues/28288: Feature: disable extensionless imports</a></li>
<li><a href="https://github.com/kulshekhar/ts-jest/issues/1174">ts-jest/issues/1174: import.meta not allowed</a></li>
<li><a href="https://github.com/evanw/esbuild/issues/1043">esbuild/issues/1043: Empty file bundles as <code>{ default: {} }</code></a></li>
<li><a href="https://stackoverflow.com/questions/64961387/how-to-use-import-meta-when-testing-with-jest">stackoverflow.com/how-to-use-import-meta-when-testing-with-jest</a></li>
<li><a href="https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c">Pure ESM package</a></li>
<li><a href="https://stackoverflow.com/questions/46745014/alternative-for-dirname-in-node-when-using-the-experimental-modules-flag">stackoverflow.com/alternative-for-dirname-in-node-when-using-the-experimental-modules-flag</a></li>
<li><a href="https://tc39.es/ecma262/#sec-imports">ecma262/#sec-imports</a></li>
<li><a href="https://dev.to/antongolub/errrequireesm-4j0h">ERR_REQUIRE_ESM</a></li>
<li><a href="https://blog.logrocket.com/publishing-node-modules-typescript-es-modules/">Publishing Node modules with TypeScript and ES modules</a></li>
</ul>

<a href="#license" id="license" style="color: inherit; text-decoration: none;">
  <h2>License</h2>
</a>
<p><a href="./LICENSE">MIT</a></p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-type-alias"><a href="modules.html#IFixOptions" class="tsd-kind-icon">IFix<wbr/>Options</a></li><li class="tsd-kind-type-alias"><a href="modules.html#IFixOptionsNormalized" class="tsd-kind-icon">IFix<wbr/>Options<wbr/>Normalized</a></li><li class="tsd-kind-type-alias"><a href="modules.html#TSConfig" class="tsd-kind-icon">TSConfig</a></li><li class="tsd-kind-variable"><a href="modules.html#DEFAULT_FIX_OPTIONS" class="tsd-kind-icon">DEFAULT_<wbr/>FIX_<wbr/>OPTIONS</a></li><li class="tsd-kind-function"><a href="modules.html#fix" class="tsd-kind-icon">fix</a></li><li class="tsd-kind-function"><a href="modules.html#fixBlankFiles" class="tsd-kind-icon">fix<wbr/>Blank<wbr/>Files</a></li><li class="tsd-kind-function"><a href="modules.html#fixContents" class="tsd-kind-icon">fix<wbr/>Contents</a></li><li class="tsd-kind-function"><a href="modules.html#fixDirnameVar" class="tsd-kind-icon">fix<wbr/>Dirname<wbr/>Var</a></li><li class="tsd-kind-function"><a href="modules.html#fixFilenameExtensions" class="tsd-kind-icon">fix<wbr/>Filename<wbr/>Extensions</a></li><li class="tsd-kind-function"><a href="modules.html#fixFilenameVar" class="tsd-kind-icon">fix<wbr/>Filename<wbr/>Var</a></li><li class="tsd-kind-function"><a href="modules.html#fixModuleReferences" class="tsd-kind-icon">fix<wbr/>Module<wbr/>References</a></li></ul></nav></div></div></div><footer class=""><div class="container"><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="overlay"></div><script src="assets/main.js"></script></body></html>